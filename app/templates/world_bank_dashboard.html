{% extends "appbuilder/base.html" %}

{% block content %}
<div class="container-fluid">
    <h1 class="my-3">World Bank Procurement Opportunities</h1>
        
    <div class="table-responsive">
        <table class="table table-striped table-hover table-bordered align-middle">
            <thead>
                <tr>
                    <th>ID</th>
                    <th>Document Type</th>
                    <th>Document Date</th>
                    <th>Display Title</th>
                    <th>PDF URL</th>
                </tr>
            </thead>
            <tbody>
                {% if world_bank_data.items %}
                    {% for wb_item in world_bank_data.items %}
                    <tr>
                        <td>{{ wb_item.id }}</td>
                        <td>{{ wb_item.docty }}</td>
                        <td>{{ wb_item.docdt.strftime('%Y-%m-%d') }}</td>
                        <td>{{ wb_item.display_title }}</td>
                        <td><a href="{{ wb_item.pdfurl }}" target="_blank">View PDF</a></td>
                    </tr>
                    {% endfor %}
                {% else %}
                    <tr>
                        <td colspan="6">No World Bank data available.</td>
                    </tr>
                {% endif %}
            </tbody>
        </table>
    </div>

    <!-- Pagination Controls -->
    <div class="pagination">
        <form method="get" action="{{ url_for('WorldBankDashboard.list') }}">
            <label for="per_page">Items per page:</label>
            <select name="per_page" id="per_page" onchange="this.form.submit()">
                <option value="30" {% if world_bank_data.per_page == 30 %}selected{% endif %}>30</option>
                <option value="50" {% if world_bank_data.per_page == 50 %}selected{% endif %}>50</option>
                <option value="100" {% if world_bank_data.per_page == 100 %}selected{% endif %}>100</option>
            </select>
        </form>

        <nav aria-label="Page navigation">
            <ul class="pagination">
                {% if world_bank_data.has_prev %}
                    <li class="page-item">
                        <a class="page-link" href="{{ url_for('WorldBankDashboard.list', page=world_bank_data.prev_num, per_page=world_bank_data.per_page) }}" aria-label="Previous">
                            <span aria-hidden="true">&laquo;</span>
                        </a>
                    </li>
                {% endif %}

                {# Display first pages (1-10) #}
                {% for page_num in range(1, min_pages + 1) %}
                    <li class="page-item {% if page_num == world_bank_data.page %}active{% endif %}">
                        <a class="page-link" href="{{ url_for('WorldBankDashboard.list', page=page_num, per_page=world_bank_data.per_page) }}">{{ page_num }}</a>
                    </li>
                {% endfor %}

                {# Display ellipsis if there are more pages #}
                {% if world_bank_data.pages > 10 %}
                    <li class="page-item disabled"><span class="page-link">...</span></li>
                {% endif %}

                {# Display last three pages #}
                {% if last_pages_start %}
                    {% for page_num in range(last_pages_start, max_pages + 1) %}
                        <li class="page-item {% if page_num == world_bank_data.page %}active{% endif %}">
                            <a class="page-link" href="{{ url_for('WorldBankDashboard.list', page=page_num, per_page=world_bank_data.per_page) }}">{{ page_num }}</a>
                        </li>
                    {% endfor %}
                {% endif %}

                {% if world_bank_data.has_next %}
                    <li class="page-item">
                        <a class="page-link" href="{{ url_for('WorldBankDashboard.list', page=world_bank_data.next_num, per_page=world_bank_data.per_page) }}" aria-label="Next">
                            <span aria-hidden="true">&raquo;</span>
                        </a>
                    </li>
                {% endif %}
            </ul>
        </nav>
    </div>
</div>
{% endblock %}